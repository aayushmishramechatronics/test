import{d as N,f as T,h as x}from"./chunk-2M5JEJPM.js";import"./chunk-ILZBBHX6.js";import{b as P,e as y,f as b,h as M,q as D}from"./chunk-B5PDLB3A.js";import{h as g}from"./chunk-B7O3QC5Z.js";var A=new WeakMap,I=(e,o,t,s=0,n=!1)=>{A.has(e)!==t&&(t?O(e,o,s,n):F(e,o))},K=e=>e===e.getRootNode().activeElement,O=(e,o,t,s=!1)=>{let n=o.parentNode,r=o.cloneNode(!1);r.classList.add("cloned-input"),r.tabIndex=-1,s&&(r.disabled=!0),n.appendChild(r),A.set(e,r);let c=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",o.style.transform=`translate3d(${c}px,${t}px,0) scale(0)`},F=(e,o)=>{let t=A.get(e);t&&(A.delete(e),t.remove()),e.style.pointerEvents="",o.style.transform=""},k=(e,o,t)=>{if(!t||!o)return()=>{};let s=c=>{K(o)&&I(e,o,c)},n=()=>I(e,o,!1),r=()=>s(!0),a=()=>s(!1);return y(t,"ionScrollStart",r),y(t,"ionScrollEnd",a),o.addEventListener("blur",n),()=>{b(t,"ionScrollStart",r),b(t,"ionScrollEnd",a),o.removeEventListener("blur",n)}},p="input, textarea, [no-blur], [contenteditable]",H=()=>{let e=!0,o=!1,t=document,s=()=>{o=!0},n=()=>{e=!0},r=a=>{if(o){o=!1;return}let c=t.activeElement;if(!c||c.matches(p))return;let d=a.target;d!==c&&(d.matches(p)||d.closest(p)||(e=!1,setTimeout(()=>{e||c.blur()},50)))};return y(t,"ionScrollStart",s),t.addEventListener("focusin",n,!0),t.addEventListener("touchend",r,!1),()=>{b(t,"ionScrollStart",s,!0),t.removeEventListener("focusin",n,!0),t.removeEventListener("touchend",r,!1)}},U=.3,Y=(e,o,t)=>{var s;let n=(s=e.closest("ion-item,[ion-item]"))!==null&&s!==void 0?s:e;return $(n.getBoundingClientRect(),o.getBoundingClientRect(),t,e.ownerDocument.defaultView.innerHeight)},$=(e,o,t,s)=>{let n=e.top,r=e.bottom,a=o.top,c=Math.min(o.bottom,s-t),d=a+15,u=c*.75-r,v=d-n,S=Math.round(u<0?-u:v>0?-v:0),m=Math.min(S,n-a),i=Math.abs(m)/U,f=Math.min(400,Math.max(150,i));return{scrollAmount:m,scrollDuration:f,scrollPadding:t,inputSafeY:-(n-d)+4}},q=(e,o,t,s,n,r=!1)=>{let a,c=l=>{a=D(l)},d=l=>{if(!a)return;let u=D(l);!W(6,a,u)&&!K(o)&&G(e,o,t,s,n,r)};return e.addEventListener("touchstart",c,{capture:!0,passive:!0}),e.addEventListener("touchend",d,!0),()=>{e.removeEventListener("touchstart",c,!0),e.removeEventListener("touchend",d,!0)}},G=(e,o,t,s,n,r=!1)=>g(void 0,null,function*(){if(!t&&!s)return;let a=Y(e,t||s,n);if(t&&Math.abs(a.scrollAmount)<4){o.focus();return}if(I(e,o,!0,a.inputSafeY,r),o.focus(),M(()=>e.click()),typeof window<"u"){let c,d=()=>g(void 0,null,function*(){c!==void 0&&clearTimeout(c),window.removeEventListener("ionKeyboardDidShow",l),window.removeEventListener("ionKeyboardDidShow",d),t&&(yield x(t,0,a.scrollAmount,a.scrollDuration)),I(e,o,!1,a.inputSafeY),o.focus()}),l=()=>{window.removeEventListener("ionKeyboardDidShow",l),window.addEventListener("ionKeyboardDidShow",d)};if(t){let u=yield N(t),v=u.scrollHeight-u.clientHeight;if(a.scrollAmount>v-u.scrollTop){o.type==="password"?(a.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",l)):window.addEventListener("ionKeyboardDidShow",d),c=setTimeout(d,1e3);return}}d()}}),W=(e,o,t)=>{if(o&&t){let s=o.x-t.x,n=o.y-t.y;return s*s+n*n>e*e}return!1},R="$ionPaddingTimer",j=e=>{let o=document,t=n=>{_(n.target,e)},s=n=>{_(n.target,0)};return o.addEventListener("focusin",t),o.addEventListener("focusout",s),()=>{o.removeEventListener("focusin",t),o.removeEventListener("focusout",s)}},_=(e,o)=>{var t,s;if(e.tagName!=="INPUT"||e.parentElement&&e.parentElement.tagName==="ION-INPUT"||((s=(t=e.parentElement)===null||t===void 0?void 0:t.parentElement)===null||s===void 0?void 0:s.tagName)==="ION-SEARCHBAR")return;let n=T(e);if(n===null)return;let r=n[R];r&&clearTimeout(r),o>0?n.style.setProperty("--keyboard-offset",`${o}px`):n[R]=setTimeout(()=>{n.style.setProperty("--keyboard-offset","0px")},120)},V=!0,X=!0,E=(e,o)=>{let t=document,s=o==="ios",n=o==="android",r=e.getNumber("keyboardHeight",290),a=e.getBoolean("scrollAssist",!0),c=e.getBoolean("hideCaretOnScroll",s),d=e.getBoolean("inputBlurring",s),l=e.getBoolean("scrollPadding",!0),u=Array.from(t.querySelectorAll("ion-input, ion-textarea")),v=new WeakMap,S=new WeakMap,m=i=>g(void 0,null,function*(){yield new Promise(L=>P(i,L));let f=i.shadowRoot||i,h=f.querySelector("input")||f.querySelector("textarea"),w=T(i),C=w?null:i.closest("ion-footer");if(!h)return;if(w&&c&&!v.has(i)){let L=k(i,h,w);v.set(i,L)}if(!(h.type==="date"||h.type==="datetime-local")&&(w||C)&&a&&!S.has(i)){let L=q(i,h,w,C,r,n);S.set(i,L)}}),B=i=>{if(c){let f=v.get(i);f&&f(),v.delete(i)}if(a){let f=S.get(i);f&&f(),S.delete(i)}};d&&V&&H(),l&&X&&j(r);for(let i of u)m(i);t.addEventListener("ionInputDidLoad",i=>{m(i.detail)}),t.addEventListener("ionInputDidUnload",i=>{B(i.detail)})};export{E as startInputShims};
